<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨æŒ‡æ¨™çœ‹æ¿</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .card { width: 90%; max-width: 400px; border-radius: 15px; border: none; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .data-box { background: #fff; padding: 15px; border-radius: 10px; margin-top: 20px; border: 1px solid #eee; display: none; }
        .val { font-weight: bold; color: #007bff; float: right; }
        .row-item { margin-bottom: 10px; border-bottom: 1px solid #f8f9fa; padding-bottom: 5px; }
    </style>
</head>
<body>

<div class="card p-4 text-center">
    <h4 class="mb-4">ğŸ“Š è²¡å‹™æŒ‡æ¨™æŸ¥è©¢</h4>
    <div class="input-group mb-3">
        <input type="text" id="symbol" class="form-control" placeholder="ä¾‹: 2330 æˆ– AAPL">
        <button class="btn btn-dark" onclick="search()">æŸ¥è©¢</button>
    </div>
    <div id="loading" style="display:none;" class="spinner-border text-primary mx-auto"></div>

    <div id="result" class="data-box text-start">
        <div class="row-item">åç¨±: <span id="resName" class="val">--</span></div>
        <div class="row-item">æœ¬ç›Šæ¯” (PE): <span id="resPE" class="val">--</span></div>
        <div class="row-item">æ¯›åˆ©ç‡ (GM): <span id="resGM" class="val">--</span></div>
    </div>
    <div id="errMsg" class="text-danger small mt-2"></div>
</div>

<script>
    function search() {
        let sym = document.getElementById('symbol').value.trim().toUpperCase();
        if(!sym) return;
        if(/^\d+$/.test(sym)) sym += ".TW"; // å°è‚¡è‡ªå‹•è£œé»

        const loading = document.getElementById('loading');
        const result = document.getElementById('result');
        const errMsg = document.getElementById('errMsg');

        loading.style.display = 'block';
        result.style.display = 'none';
        errMsg.innerText = "";

        // ä½¿ç”¨ JSONP æŠ€è¡“ï¼ˆé€™æ˜¯ç¹é Load failed æœ€è€ç‰Œä¸”ç©©å®šçš„æ–¹æ³•ï¼‰
        const script = document.createElement('script');
        const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
        
        window[callbackName] = function(data) {
            delete window[callbackName];
            document.body.removeChild(script);
            
            try {
                const quote = data.quoteSummary.result[0];
                document.getElementById('resName').innerText = sym;
                document.getElementById('resPE').innerText = quote.summaryDetail.trailingPE?.fmt || "N/A";
                document.getElementById('resGM').innerText = quote.financialData.grossMargins?.fmt || "N/A";
                
                loading.style.display = 'none';
                result.style.display = 'block';
            } catch (e) {
                loading.style.display = 'none';
                errMsg.innerText = "æ‰¾ä¸åˆ°æ•¸æ“šï¼Œè«‹ç¢ºèªä»£è™Ÿæ˜¯å¦æ­£ç¢ºã€‚";
            }
        };

        // é€é yql çš„å‚™æ´æ©Ÿåˆ¶æŠ“å– Yahoo æ•¸æ“š
        script.src = `https://query1.finance.yahoo.com/v10/finance/quoteSummary/${sym}?modules=summaryDetail,financialData&callback=${callbackName}`;
        document.body.appendChild(script);
        
        // è¨­å®šè¶…æ™‚è™•ç†
        setTimeout(() => {
            if(loading.style.display === 'block') {
                loading.style.display = 'none';
                errMsg.innerText = "é€£ç·šè¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚";
            }
        }, 5000);
    }
</script>

</body>
</html>
